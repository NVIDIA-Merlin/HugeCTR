{
  "solver": {
    "lr_policy": "fixed",
    "display": 200,
    "max_iter": 50000,
    "gpu": [0,1],
    "batchsize": 40960,
    "snapshot": 10000,
    "snapshot_prefix": "./",
    "eval_interval": 1000,
    "eval_batches": 100,
    "mixed_precision": 1024
  },

  "optimizer": {
    "type": "Adam",
    "update_type": "Global",
    "adam_hparam": {
      "learning_rate": 0.005,
      "beta1": 0.9,
      "beta2": 0.999,
      "epsilon": 0.0001
    }
  },

  "layers": [ 
  {
      "name": "data",
      "type": "Data",
      "source": "./simple_sparse_embedding/simple_sparse_embedding_file_list.txt",
      "eval_source": "./simple_sparse_embedding/simple_sparse_embedding_file_list.txt",
      "check": "Sum",
      "label": {
        "top": "label",
        "label_dim": 1
      },
      "dense": {
        "top": "dense",
        "dense_dim": 64
      },
      "sparse": [
        {
          "top": "data1",
          "type": "DistributedSlot",
          "max_feature_num_per_sample": 100,
          "slot_num": 10
        },
        
        {
          "top": "data2",
          "type": "LocalizedSlot",
          "max_feature_num_per_sample": 100,
          "slot_num": 10
        }   
      ]
    },
    
    
    {
      "name": "sparse_embedding1",
      "type": "DistributedSlotSparseEmbeddingHash",
      "bottom": "data1",
      "top": "sparse_embedding1",
      "sparse_embedding_hparam": {
        "max_vocabulary_size_per_gpu": 2603616,
        "embedding_vec_size": 64,
        "combiner": 1
      }
    },

    {
      "name": "sparse_embedding2",
      "type": "LocalizedSlotSparseEmbeddingHash",
      "plan_file": "./all2all_plan.json",
      "bottom": "data2",
      "top": "sparse_embedding2",
      "sparse_embedding_hparam": {
        "max_vocabulary_size_per_gpu": 1301808,
        "embedding_vec_size": 64,
        "combiner": 1
      }
    },

    {
      "name": "reshape1",
      "type": "Reshape",
      "bottom": "sparse_embedding1",
      "top": "reshape1",
      "leading_dim": 640
    },

    {
      "name": "reshape2",
      "type": "Reshape",
      "bottom": "sparse_embedding2",
      "top": "reshape2",
      "leading_dim": 640
    },

    {
      "name": "concat1",
      "type": "Concat",
      "bottom": ["reshape1","reshape2","dense"],
      "top": "concat1"
    },

    {
      "name": "fc1",
      "type": "InnerProduct",
      "bottom": "concat1",
      "top": "fc1",
       "fc_param": {
        "num_output": 200
      }
    },

    {
      "name": "relu1",
      "type": "ReLU",
      "bottom": "fc1",
      "top": "relu1"
     
    },

    {
      "name": "slice1",
      "type": "Slice",
      "bottom": "relu1",
      "ranges": [[0,50], [100,200]],
      "top": ["slice11", "slice12"]
    },

    {
      "name": "fc2",
      "type": "InnerProduct",
      "bottom": "slice11",
      "top": "fc2",
       "fc_param": {
        "num_output": 1
      }
    },

    {
      "name": "loss",
      "type": "BinaryCrossEntropyLoss",
      "bottom": ["fc2","label"],
      "regularizer": "L2",
      "lambda": 0.0005,
      "top": "loss"
    } 
  ]
}
