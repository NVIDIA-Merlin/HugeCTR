<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HugeCTR Training with Remote File System Example &mdash; Merlin HugeCTR  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
    <link rel="canonical" href="https://nvidia-merlin.github.io/HugeCTR/main/notebooks/training_with_remote_filesystem.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HugeCTR Embedding Collection" href="embedding_collection.html" />
    <link rel="prev" title="HugeCTR Example Notebooks" href="index.html" /> 
</head>

<body class="wy-body-for-nav">
  <div class="banner">
    <p class="banner">
      Since the HugeCTR <code>v23.09</code>, the offline inference has been deprecated.
      Since the HugeCTR <code>v24.06</code>, the HPS has been deprecated.
  </div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Merlin HugeCTR
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">HUGECTR</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../hugectr_user_guide.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hugectr_core_features.html">Core Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparse_operation_kit.html">Sparse Operation Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Example Notebooks</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">HugeCTR Training with Remote File System Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="embedding_collection.html">HugeCTR Embedding Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="hugectr_e2e_demo_with_nvtabular.html">HugeCTR End-end Example with NVTabular</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="multi-modal-data/index.html">Multi-modal Example Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional_resources.html">Additional Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hugectr_contributor_guide.html">Contributing to HugeCTR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hierarchical_parameter_server/index.html">Hierarchical Parameter Server [Deprecated]</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Merlin HugeCTR</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">HugeCTR Example Notebooks</a></li>
      <li class="breadcrumb-item active">HugeCTR Training with Remote File System Example</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright 2021 NVIDIA Corporation. All Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1"># ==============================================================================</span>

<span class="c1"># Each user is responsible for checking the content of datasets and the</span>
<span class="c1"># applicable licenses and determining if suitable for the intended use.</span>
</pre></div>
</div>
</div>
</div>
<img alt="http://developer.download.nvidia.com/notebooks/dlsw-notebooks/merlin_hugectr_training-with-hdfs/nvidia_logo.png" src="http://developer.download.nvidia.com/notebooks/dlsw-notebooks/merlin_hugectr_training-with-hdfs/nvidia_logo.png" />
<section class="tex2jax_ignore mathjax_ignore" id="hugectr-training-with-remote-file-system-example">
<h1>HugeCTR Training with Remote File System Example<a class="headerlink" href="#hugectr-training-with-remote-file-system-example" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>HugeCTR supports reading Parquet data, loading and saving models from/to remote file systems like HDFS, AWS S3, and GCS. Users can read their data stored in these remote file systems and train with it. And after training, users can choose to dump the trained parameters and optimizer states into these file systems.</p>
</section>
<section id="setup-hugectr">
<h2>Setup HugeCTR<a class="headerlink" href="#setup-hugectr" title="Permalink to this heading"></a></h2>
<p>To setup the environment, refer to <a class="reference internal" href="#../notebooks"><span class="xref myst">HugeCTR Example Notebooks</span></a> and follow the instructions there before running the following.</p>
</section>
<section id="training-with-hdfs-example">
<h2>Training with HDFS Example<a class="headerlink" href="#training-with-hdfs-example" title="Permalink to this heading"></a></h2>
<p>Hadoop is not pre-installe din the Merlin Training Container. To help you build and install HDFS, we provide a script <a class="reference external" href="https://github.com/NVIDIA-Merlin/HugeCTR/tree/master/sbin">here</a>. Please build and install Hadoop using these two scripts. Make sure you have hadoop installed in your Container by running the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>hadoop<span class="w"> </span>version
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hadoop 3.3.2
Source code repository https://github.com/apache/hadoop.git -r 0bcb014209e219273cb6fd4152df7df713cbac61
Compiled by root on 2022-07-25T09:53Z
Compiled with protoc 3.7.1
From source with checksum 4b40fff8bb27201ba07b6fa5651217fb
This command was run using /opt/hadoop/share/hadoop/common/hadoop-common-3.3.2.jar
</pre></div>
</div>
</div>
</div>
<section id="data-preparation">
<h3>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading"></a></h3>
<p>Users can use the <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/master/api/python_interface.html#data-source-api">DataSourceParams</a> to setup file system configurations. Currently, we support <code class="docutils literal notranslate"><span class="pre">Local</span></code>, <code class="docutils literal notranslate"><span class="pre">HDFS</span></code>, <code class="docutils literal notranslate"><span class="pre">S3</span></code>, and <code class="docutils literal notranslate"><span class="pre">GCS</span></code>.</p>
<p><strong>Firstly, we want to make sure that we have train and validation datasets ready:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-ls<span class="w"> </span>hdfs://10.19.172.76:9000/dlrm_parquet/train
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 8 items
-rw-r--r--   1 root supergroup  112247365 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/train/gen_0.parquet
-rw-r--r--   1 root supergroup  112243637 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/train/gen_1.parquet
-rw-r--r--   1 root supergroup  112251207 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/train/gen_2.parquet
-rw-r--r--   1 root supergroup  112241764 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/train/gen_3.parquet
-rw-r--r--   1 root supergroup  112247838 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/train/gen_4.parquet
-rw-r--r--   1 root supergroup  112244076 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/train/gen_5.parquet
-rw-r--r--   1 root supergroup  112253553 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/train/gen_6.parquet
-rw-r--r--   1 root supergroup  112249557 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/train/gen_7.parquet
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-ls<span class="w"> </span>hdfs://10.19.172.76:9000/dlrm_parquet/val
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 2 items
-rw-r--r--   1 root supergroup  112239093 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/val/gen_0.parquet
-rw-r--r--   1 root supergroup  112249156 2022-07-27 06:19 hdfs://10.19.172.76:9000/dlrm_parquet/val/gen_1.parquet
</pre></div>
</div>
</div>
</div>
<p><strong>Secondly, create <code class="docutils literal notranslate"><span class="pre">file_list.txt</span> <span class="pre">and</span> <span class="pre">file_list_test.txt</span></code>:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mkdir<span class="w"> </span>/dlrm_parquet
<span class="o">!</span>mkdir<span class="w"> </span>/dlrm_parquet/train
<span class="o">!</span>mkdir<span class="w"> </span>/dlrm_parquet/val
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /dlrm_parquet/file_list.txt
<span class="mi">8</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_0</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_1</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_2</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_3</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_4</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_5</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_6</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_7</span><span class="o">.</span><span class="n">parquet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting /dlrm_parquet/file_list.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /dlrm_parquet/file_list_test.txt
<span class="mi">2</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_0</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">hdfs</span><span class="p">:</span><span class="o">//</span><span class="mf">10.19.172.76</span><span class="p">:</span><span class="mi">9000</span><span class="o">/</span><span class="n">dlrm_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_1</span><span class="o">.</span><span class="n">parquet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting /dlrm_parquet/file_list_test.txt
</pre></div>
</div>
</div>
</div>
<p><strong>Lastly, create <code class="docutils literal notranslate"><span class="pre">_metadata.json</span></code> for both train and validation dataset to specify the feature information of your dataset:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /dlrm_parquet/train/_metadata.json
<span class="p">{</span> <span class="s2">&quot;file_stats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/train/gen_0.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/train/gen_1.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/train/gen_2.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/train/gen_3.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/train/gen_4.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/train/gen_5.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/train/gen_6.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/train/gen_7.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;label0&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;conts&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C5&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C6&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C7&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C8&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C9&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C10&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C11&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C12&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">12</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C13&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;cats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C14&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C15&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C16&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C17&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">17</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C18&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">18</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C19&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C20&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C21&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C22&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">22</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C23&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C24&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C25&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C26&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">26</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C27&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">27</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C28&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">28</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C29&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">29</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C30&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C31&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">31</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C32&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">32</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C33&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C34&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">34</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C35&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C36&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">36</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C37&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">37</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C38&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">38</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C39&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">39</span><span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing /dlrm_parquet/train/_metadata.json
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /dlrm_parquet/val/_metadata.json
<span class="p">{</span> <span class="s2">&quot;file_stats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/val/gen_0.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;./dlrm_parquet/val/gen_1.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;label0&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;conts&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C5&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C6&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C7&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C8&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C9&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C10&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C11&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C12&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">12</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C13&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;cats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C14&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C15&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C16&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C17&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">17</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C18&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">18</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C19&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C20&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C21&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C22&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">22</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C23&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C24&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C25&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C26&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">26</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C27&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">27</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C28&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">28</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C29&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">29</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C30&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C31&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">31</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C32&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">32</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C33&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C34&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">34</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C35&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C36&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">36</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C37&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">37</span><span class="p">},</span> 
           <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C38&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">38</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C39&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">39</span><span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing /dlrm_parquet/val/_metadata.json
</pre></div>
</div>
</div>
</div>
</section>
<section id="training-a-dlrm-model">
<h3>Training a DLRM model<a class="headerlink" href="#training-a-dlrm-model" title="Permalink to this heading"></a></h3>
<p><strong>Important APIs used in the following script:</strong></p>
<ol class="arabic simple">
<li><p>We use the <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/main/api/python_interface.html#datasourceparams-class">DataSourceParams</a> to define the remote file system to read data from</p></li>
<li><p>In <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/main/api/python_interface.html#datareaderparams">DataReaderParams</a>, we specify the <code class="docutils literal notranslate"><span class="pre">DataSourceParams</span></code>.</p></li>
<li><p>In <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/main/api/python_interface.html#fit-method">fit()</a> method, we specify HDFS path in the <code class="docutils literal notranslate"><span class="pre">snapshot_prefix</span></code> parameters to dump trained models to HDFS.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> train_with_hdfs.py
<span class="kn">import</span> <span class="nn">hugectr</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">from</span> <span class="nn">hugectr.data</span> <span class="kn">import</span> <span class="n">DataSourceParams</span>

<span class="c1"># Create a file system configuration </span>
<span class="n">data_source_params</span> <span class="o">=</span> <span class="n">DataSourceParams</span><span class="p">(</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">DataSourceType_t</span><span class="o">.</span><span class="n">HDFS</span><span class="p">,</span> <span class="c1">#use HDFS</span>
    <span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;10.19.172.76&#39;</span><span class="p">,</span> <span class="c1">#your HDFS namenode IP</span>
    <span class="n">port</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span> <span class="c1">#your HDFS namenode port</span>
<span class="p">)</span>

<span class="c1"># DLRM train</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">CreateSolver</span><span class="p">(</span><span class="n">max_eval_batches</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">,</span>
                              <span class="n">batchsize_eval</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
                              <span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
                              <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                              <span class="n">vvgpu</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">]],</span>
                              <span class="n">i64_input_key</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                              <span class="n">use_mixed_precision</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="n">repeat_dataset</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                              <span class="n">use_cuda_graph</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderParams</span><span class="p">(</span><span class="n">data_reader_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderType_t</span><span class="o">.</span><span class="n">Parquet</span><span class="p">,</span>
                                  <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/dlrm_parquet/file_list.txt&quot;</span><span class="p">],</span>
                                  <span class="n">eval_source</span> <span class="o">=</span> <span class="s2">&quot;/dlrm_parquet/file_list_test.txt&quot;</span><span class="p">,</span>
                                  <span class="n">slot_size_array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">405274</span><span class="p">,</span> <span class="mi">72550</span><span class="p">,</span> <span class="mi">55008</span><span class="p">,</span> <span class="mi">222734</span><span class="p">,</span> <span class="mi">316071</span><span class="p">,</span> <span class="mi">156265</span><span class="p">,</span> <span class="mi">220243</span><span class="p">,</span> <span class="mi">200179</span><span class="p">,</span> <span class="mi">234566</span><span class="p">,</span> <span class="mi">335625</span><span class="p">,</span> <span class="mi">278726</span><span class="p">,</span> <span class="mi">263070</span><span class="p">,</span> <span class="mi">312542</span><span class="p">,</span> <span class="mi">203773</span><span class="p">,</span> <span class="mi">145859</span><span class="p">,</span> <span class="mi">117421</span><span class="p">,</span> <span class="mi">78140</span><span class="p">,</span> <span class="mi">3648</span><span class="p">,</span> <span class="mi">156308</span><span class="p">,</span> <span class="mi">94562</span><span class="p">,</span> <span class="mi">357703</span><span class="p">,</span> <span class="mi">386976</span><span class="p">,</span> <span class="mi">238046</span><span class="p">,</span> <span class="mi">230917</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">156382</span><span class="p">],</span>
                                  <span class="n">data_source_params</span> <span class="o">=</span> <span class="n">data_source_params</span><span class="p">,</span> <span class="c1">#file system config for data reading</span>
                                  <span class="n">check_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Check_t</span><span class="o">.</span><span class="n">Non</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">CreateOptimizer</span><span class="p">(</span><span class="n">optimizer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Optimizer_t</span><span class="o">.</span><span class="n">SGD</span><span class="p">,</span>
                                    <span class="n">update_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Update_t</span><span class="o">.</span><span class="n">Local</span><span class="p">,</span>
                                    <span class="n">atomic_update</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">label_dim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label_name</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
                        <span class="n">dense_dim</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="n">dense_name</span> <span class="o">=</span> <span class="s2">&quot;dense&quot;</span><span class="p">,</span>
                        <span class="n">data_reader_sparse_param_array</span> <span class="o">=</span> 
                        <span class="p">[</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderSparseParam</span><span class="p">(</span><span class="s2">&quot;data1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">26</span><span class="p">)]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">SparseEmbedding</span><span class="p">(</span><span class="n">embedding_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Embedding_t</span><span class="o">.</span><span class="n">DistributedSlotSparseEmbeddingHash</span><span class="p">,</span>
                            <span class="n">workspace_size_per_gpu_in_mb</span> <span class="o">=</span> <span class="mi">10720</span><span class="p">,</span>
                            <span class="n">embedding_vec_size</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
                            <span class="n">combiner</span> <span class="o">=</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
                            <span class="n">sparse_embedding_name</span> <span class="o">=</span> <span class="s2">&quot;sparse_embedding1&quot;</span><span class="p">,</span>
                            <span class="n">bottom_name</span> <span class="o">=</span> <span class="s2">&quot;data1&quot;</span><span class="p">,</span>
                            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc1&quot;</span><span class="p">],</span>
                            <span class="n">num_output</span><span class="o">=</span><span class="mi">512</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc1&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu1&quot;</span><span class="p">]))</span>                           
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu1&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc2&quot;</span><span class="p">],</span>
                            <span class="n">num_output</span><span class="o">=</span><span class="mi">256</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc2&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu2&quot;</span><span class="p">]))</span>                            
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu2&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc3&quot;</span><span class="p">],</span>
                            <span class="n">num_output</span><span class="o">=</span><span class="mi">128</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc3&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu3&quot;</span><span class="p">]))</span>                              
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Interaction</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu3&quot;</span><span class="p">,</span><span class="s2">&quot;sparse_embedding1&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;interaction1&quot;</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;interaction1&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc4&quot;</span><span class="p">],</span>
                            <span class="n">num_output</span><span class="o">=</span><span class="mi">1024</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc4&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu4&quot;</span><span class="p">]))</span>                              
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu4&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc5&quot;</span><span class="p">],</span>
                            <span class="n">num_output</span><span class="o">=</span><span class="mi">1024</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc5&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu5&quot;</span><span class="p">]))</span>                              
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu5&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc6&quot;</span><span class="p">],</span>
                            <span class="n">num_output</span><span class="o">=</span><span class="mi">512</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc6&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu6&quot;</span><span class="p">]))</span>                               
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu6&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc7&quot;</span><span class="p">],</span>
                            <span class="n">num_output</span><span class="o">=</span><span class="mi">256</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc7&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu7&quot;</span><span class="p">]))</span>                                                                              
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;relu7&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc8&quot;</span><span class="p">],</span>
                            <span class="n">num_output</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>                                                                                           
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">BinaryCrossEntropyLoss</span><span class="p">,</span>
                            <span class="n">bottom_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fc8&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">],</span>
                            <span class="n">top_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">max_iter</span> <span class="o">=</span> <span class="mi">2020</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">eval_interval</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">snapshot</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">snapshot_prefix</span> <span class="o">=</span> <span class="s2">&quot;hdfs://10.19.172.76:9000/model/dlrm/&quot;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting train_with_hdfs.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>train_with_hdfs.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HugeCTR Version: 3.8
====================================================Model Init=====================================================
[HCTR][07:51:52.502][WARNING][RK0][main]: The model name is not specified when creating the solver.
[HCTR][07:51:52.502][INFO][RK0][main]: Global seed is 3218787045
[HCTR][07:51:52.505][INFO][RK0][main]: Device to NUMA mapping:
  GPU 1 -&gt;  node 0
[HCTR][07:51:55.607][WARNING][RK0][main]: Peer-to-peer access cannot be fully enabled.
[HCTR][07:51:55.607][INFO][RK0][main]: Start all2all warmup
[HCTR][07:51:55.609][INFO][RK0][main]: End all2all warmup
[HCTR][07:51:56.529][INFO][RK0][main]: Using All-reduce algorithm: NCCL
[HCTR][07:51:56.530][INFO][RK0][main]: Device 1: NVIDIA A10
[HCTR][07:51:56.531][INFO][RK0][main]: num of DataReader workers for train: 1
[HCTR][07:51:56.531][INFO][RK0][main]: num of DataReader workers for eval: 1
[HCTR][07:51:57.695][INFO][RK0][main]: Using Hadoop Cluster 10.19.172.76:9000
[HCTR][07:51:57.740][INFO][RK0][main]: Using Hadoop Cluster 10.19.172.76:9000
[HCTR][07:51:57.740][INFO][RK0][main]: Vocabulary size: 5242880
[HCTR][07:51:57.741][INFO][RK0][main]: max_vocabulary_size_per_gpu_=21954560
[HCTR][07:51:57.755][INFO][RK0][main]: Graph analysis to resolve tensor dependency
===================================================Model Compile===================================================
[HCTR][07:52:04.336][INFO][RK0][main]: gpu0 start to init embedding
[HCTR][07:52:04.411][INFO][RK0][main]: gpu0 init embedding done
[HCTR][07:52:04.413][INFO][RK0][main]: Starting AUC NCCL warm-up
[HCTR][07:52:04.415][INFO][RK0][main]: Warm-up done
===================================================Model Summary===================================================
[HCTR][07:52:04.415][INFO][RK0][main]: label                                   Dense                         Sparse                        
label                                   dense                          data1                         
(None, 1)                               (None, 13)                              
——————————————————————————————————————————————————————————————————————————————————————————————————————————————————
Layer Type                              Input Name                    Output Name                   Output Shape                  
——————————————————————————————————————————————————————————————————————————————————————————————————————————————————
DistributedSlotSparseEmbeddingHash      data1                         sparse_embedding1             (None, 26, 128)               
------------------------------------------------------------------------------------------------------------------
InnerProduct                            dense                         fc1                           (None, 512)                   
------------------------------------------------------------------------------------------------------------------
ReLU                                    fc1                           relu1                         (None, 512)                   
------------------------------------------------------------------------------------------------------------------
InnerProduct                            relu1                         fc2                           (None, 256)                   
------------------------------------------------------------------------------------------------------------------
ReLU                                    fc2                           relu2                         (None, 256)                   
------------------------------------------------------------------------------------------------------------------
InnerProduct                            relu2                         fc3                           (None, 128)                   
------------------------------------------------------------------------------------------------------------------
ReLU                                    fc3                           relu3                         (None, 128)                   
------------------------------------------------------------------------------------------------------------------
Interaction                             relu3                         interaction1                  (None, 480)                   
                                        sparse_embedding1                                                                         
------------------------------------------------------------------------------------------------------------------
InnerProduct                            interaction1                  fc4                           (None, 1024)                  
------------------------------------------------------------------------------------------------------------------
ReLU                                    fc4                           relu4                         (None, 1024)                  
------------------------------------------------------------------------------------------------------------------
InnerProduct                            relu4                         fc5                           (None, 1024)                  
------------------------------------------------------------------------------------------------------------------
ReLU                                    fc5                           relu5                         (None, 1024)                  
------------------------------------------------------------------------------------------------------------------
InnerProduct                            relu5                         fc6                           (None, 512)                   
------------------------------------------------------------------------------------------------------------------
ReLU                                    fc6                           relu6                         (None, 512)                   
------------------------------------------------------------------------------------------------------------------
InnerProduct                            relu6                         fc7                           (None, 256)                   
------------------------------------------------------------------------------------------------------------------
ReLU                                    fc7                           relu7                         (None, 256)                   
------------------------------------------------------------------------------------------------------------------
InnerProduct                            relu7                         fc8                           (None, 1)                     
------------------------------------------------------------------------------------------------------------------
BinaryCrossEntropyLoss                  fc8                           loss                                                        
                                        label                                                                                     
------------------------------------------------------------------------------------------------------------------
=====================================================Model Fit=====================================================
[HCTR][07:52:04.415][INFO][RK0][main]: Use non-epoch mode with number of iterations: 2020
[HCTR][07:52:04.415][INFO][RK0][main]: Training batchsize: 1024, evaluation batchsize: 1024
[HCTR][07:52:04.415][INFO][RK0][main]: Evaluation interval: 1000, snapshot interval: 2000
[HCTR][07:52:04.415][INFO][RK0][main]: Dense network trainable: True
[HCTR][07:52:04.415][INFO][RK0][main]: Sparse embedding sparse_embedding1 trainable: True
[HCTR][07:52:04.415][INFO][RK0][main]: Use mixed precision: False, scaler: 1.000000, use cuda graph: False
[HCTR][07:52:04.415][INFO][RK0][main]: lr: 0.010000, warmup_steps: 1, end_lr: 0.000000
[HCTR][07:52:04.415][INFO][RK0][main]: decay_start: 0, decay_steps: 1, decay_power: 2.000000
[HCTR][07:52:04.415][INFO][RK0][main]: Training source file: /dlrm_parquet/file_list.txt
[HCTR][07:52:04.415][INFO][RK0][main]: Evaluation source file: /dlrm_parquet/file_list_test.txt
[HCTR][07:52:05.134][INFO][RK0][main]: Iter: 200 Time(200 iters): 0.716815s Loss: 0.69327 lr:0.01
[HCTR][07:52:05.856][INFO][RK0][main]: Iter: 400 Time(200 iters): 0.719486s Loss: 0.693207 lr:0.01
[HCTR][07:52:06.608][INFO][RK0][main]: Iter: 600 Time(200 iters): 0.750294s Loss: 0.693568 lr:0.01
[HCTR][07:52:07.331][INFO][RK0][main]: Iter: 800 Time(200 iters): 0.721128s Loss: 0.693352 lr:0.01
[HCTR][07:52:09.118][INFO][RK0][main]: Iter: 1000 Time(200 iters): 1.78435s Loss: 0.693352 lr:0.01
[HCTR][07:52:11.667][INFO][RK0][main]: Evaluation, AUC: 0.499891
[HCTR][07:52:11.668][INFO][RK0][main]: Eval Time for 1280 iters: 2.5486s
[HCTR][07:52:12.393][INFO][RK0][main]: Iter: 1200 Time(200 iters): 3.2728s Loss: 0.693178 lr:0.01
[HCTR][07:52:13.116][INFO][RK0][main]: Iter: 1400 Time(200 iters): 0.720984s Loss: 0.693292 lr:0.01
[HCTR][07:52:13.875][INFO][RK0][main]: Iter: 1600 Time(200 iters): 0.756448s Loss: 0.693053 lr:0.01
[HCTR][07:52:14.603][INFO][RK0][main]: Iter: 1800 Time(200 iters): 0.725832s Loss: 0.693433 lr:0.01
[HCTR][07:52:16.382][INFO][RK0][main]: Iter: 2000 Time(200 iters): 1.77763s Loss: 0.693193 lr:0.01
[HCTR][07:52:18.959][INFO][RK0][main]: Evaluation, AUC: 0.500092
[HCTR][07:52:18.959][INFO][RK0][main]: Eval Time for 1280 iters: 2.57548s
[HCTR][07:52:19.575][INFO][RK0][main]: Rank0: Write hash table to file
[HDFS][INFO]: Write to HDFS /model/dlrm/0_sparse_2000.model/key successfully!
[HDFS][INFO]: Write to HDFS /model/dlrm/0_sparse_2000.model/emb_vector successfully!
[HCTR][07:52:31.132][INFO][RK0][main]: Dumping sparse weights to files, successful
[HCTR][07:52:31.132][INFO][RK0][main]: Dumping sparse optimzer states to files, successful
[HDFS][INFO]: Write to HDFS /model/dlrm/_dense_2000.model successfully!
[HCTR][07:52:31.307][INFO][RK0][main]: Dumping dense weights to HDFS, successful
[HDFS][INFO]: Write to HDFS /model/dlrm/_opt_dense_2000.model successfully!
[HCTR][07:52:31.365][INFO][RK0][main]: Dumping dense optimizer states to HDFS, successful
[HCTR][07:52:31.430][INFO][RK0][main]: Finish 2020 iterations with batchsize: 1024 in 27.02s.
</pre></div>
</div>
</div>
</div>
<p><strong>Check that our model files are saved in HDFS:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-ls<span class="w"> </span>hdfs://10.19.172.76:9000/model/dlrm
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 3 items
drwxr-xr-x   - root supergroup          0 2022-07-27 07:52 hdfs://10.19.172.76:9000/model/dlrm/0_sparse_2000.model
-rw-r--r--   3 root supergroup    9479684 2022-07-27 07:52 hdfs://10.19.172.76:9000/model/dlrm/_dense_2000.model
-rw-r--r--   3 root supergroup          0 2022-07-27 07:52 hdfs://10.19.172.76:9000/model/dlrm/_opt_dense_2000.model
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="training-a-dcn-model-with-aws-s3">
<h2>Training a DCN model with AWS S3<a class="headerlink" href="#training-a-dcn-model-with-aws-s3" title="Permalink to this heading"></a></h2>
<p><strong>Before you start:</strong>
Please note that AWS S3 SDKs are NOT preinstalled in the NGC docker. To use S3 related functionalites, please do the following steps to customize the building of HugeCTR:</p>
<ol class="arabic simple">
<li><p>git clone <a class="reference external" href="https://github.com/NVIDIA/HugeCTR.git">https://github.com/NVIDIA/HugeCTR.git</a></p></li>
<li><p>cd HugeCTR</p></li>
<li><p>git submodule update –init –recursive</p></li>
<li><p>mkdir -p build &amp;&amp; cd build</p></li>
<li><p>cmake -DCMAKE_BUILD_TYPE=Release -DSM=70 -DENABLE_S3=ON … #ENABLE_S3 option will install AWS S3 SDKs for you.</p></li>
<li><p>make -j &amp;&amp; make install</p></li>
</ol>
<section id="id1">
<h3>Data preparation<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p><strong>Create <code class="docutils literal notranslate"><span class="pre">file_list.txt</span> <span class="pre">and</span> <span class="pre">file_list_test.txt</span></code>:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mkdir<span class="w"> </span>-p<span class="w"> </span>/hugectr-io-test/data/dcn_parquet/train
<span class="o">!</span>mkdir<span class="w"> </span>-p<span class="w"> </span>/hugectr-io-test/data/dcn_parquet/val
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /hugectr-io-test/data/dcn_parquet/file_list.txt
<span class="mi">16</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_0</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_1</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_2</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_3</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_4</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_5</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_6</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_7</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_8</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_9</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_10</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_11</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_12</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_13</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_14</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_15</span><span class="o">.</span><span class="n">parquet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing /hugectr-io-test/data/dcn_parquet/file_list.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /hugectr-io-test/data/dcn_parquet/file_list_test.txt
<span class="mi">4</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_0</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_1</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_2</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_3</span><span class="o">.</span><span class="n">parquet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing /hugectr-io-test/data/dcn_parquet/file_list_test.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /hugectr-io-test/data/dcn_parquet/train/_metadata.json
<span class="p">{</span> <span class="s2">&quot;file_stats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_0.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_1.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_2.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_3.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_4.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_5.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_6.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_7.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span>
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_8.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_9.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_10.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_11.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_12.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_13.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_14.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/train/gen_15.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">}],</span> 
  <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;label0&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;conts&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C5&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C6&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C7&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C8&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C9&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C10&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C11&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C12&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">12</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C13&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;cats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C14&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C15&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C16&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C17&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">17</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C18&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">18</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C19&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C20&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C21&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C22&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">22</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C23&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C24&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C25&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C26&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">26</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C27&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">27</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C28&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">28</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C29&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">29</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C30&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C31&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">31</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C32&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">32</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C33&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C34&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">34</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C35&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C36&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">36</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C37&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">37</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C38&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">38</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C39&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">39</span><span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing /hugectr-io-test/data/dcn_parquet/train/_metadata.json
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /hugectr-io-test/data/dcn_parquet/val/_metadata.json
<span class="p">{</span> <span class="s2">&quot;file_stats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/val/gen_0.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/val/gen_1.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span>
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/val/gen_2.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://hugectr-io-test/data/dcn_parquet/val/gen_3.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">}],</span> 
  <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;label0&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;conts&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C5&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C6&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C7&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C8&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C9&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C10&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C11&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C12&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">12</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C13&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;cats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C14&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C15&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C16&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C17&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">17</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C18&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">18</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C19&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C20&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C21&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C22&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">22</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C23&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C24&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C25&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C26&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">26</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C27&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">27</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C28&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">28</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C29&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">29</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C30&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C31&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">31</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C32&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">32</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C33&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C34&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">34</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C35&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C36&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">36</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C37&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">37</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C38&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">38</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C39&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">39</span><span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing /hugectr-io-test/data/dcn_parquet/val/_metadata.json
</pre></div>
</div>
</div>
</div>
</section>
<section id="training">
<h3>Training<a class="headerlink" href="#training" title="Permalink to this heading"></a></h3>
<p><strong>Important APIs used in the following script:</strong></p>
<ol class="arabic simple">
<li><p>We use the <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/main/api/python_interface.html#datasourceparams-class">DataSourceParams</a> to define the remote file system to read data from, in this case, S3.</p></li>
<li><p>In <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/main/api/python_interface.html#datareaderparams">DataReaderParams</a>, we specify the <code class="docutils literal notranslate"><span class="pre">DataSourceParams</span></code>.</p></li>
<li><p>In <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/main/api/python_interface.html#fit-method">fit()</a> method, we specify S3 path in the <code class="docutils literal notranslate"><span class="pre">snapshot_prefix</span></code> parameters to dump trained models to S3.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> train_with_s3.py
<span class="kn">import</span> <span class="nn">hugectr</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">from</span> <span class="nn">hugectr.data</span> <span class="kn">import</span> <span class="n">DataSourceParams</span>

<span class="c1"># Create a file system configuration for data reading</span>
<span class="n">data_source_params</span> <span class="o">=</span> <span class="n">DataSourceParams</span><span class="p">(</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">FileSystemType_t</span><span class="o">.</span><span class="n">S3</span><span class="p">,</span> <span class="c1">#use AWS S3</span>
    <span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;us-east-1&#39;</span><span class="p">,</span> <span class="c1">#your AWS region</span>
    <span class="n">port</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span> <span class="c1">#with be ignored</span>
<span class="p">)</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">CreateSolver</span><span class="p">(</span>
    <span class="n">max_eval_batches</span><span class="o">=</span><span class="mi">1280</span><span class="p">,</span>
    <span class="n">batchsize_eval</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="n">batchsize</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">vvgpu</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">i64_input_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">repeat_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderParams</span><span class="p">(</span>
    <span class="n">data_reader_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderType_t</span><span class="o">.</span><span class="n">Parquet</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/hugectr-io-test/data/dcn_parquet/file_list.txt&quot;</span><span class="p">],</span>
    <span class="n">eval_source</span><span class="o">=</span><span class="s2">&quot;/hugectr-io-test/data/dcn_parquet/file_list_test.txt&quot;</span><span class="p">,</span>
    <span class="n">slot_size_array</span><span class="o">=</span><span class="p">[</span><span class="mi">39884</span><span class="p">,</span><span class="mi">39043</span><span class="p">,</span><span class="mi">17289</span><span class="p">,</span><span class="mi">7420</span><span class="p">,</span><span class="mi">20263</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7120</span><span class="p">,</span><span class="mi">1543</span><span class="p">,</span><span class="mi">39884</span><span class="p">,</span><span class="mi">39043</span><span class="p">,</span><span class="mi">17289</span><span class="p">,</span><span class="mi">7420</span><span class="p">,</span><span class="mi">20263</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7120</span><span class="p">,</span><span class="mi">1543</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">39884</span><span class="p">,</span><span class="mi">39043</span><span class="p">,</span><span class="mi">17289</span><span class="p">,</span><span class="mi">7420</span><span class="p">,</span><span class="mi">20263</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7120</span><span class="p">,</span><span class="mi">1543</span><span class="p">],</span>
    <span class="n">data_source_params</span><span class="o">=</span><span class="n">data_source_params</span><span class="p">,</span> <span class="c1"># Using the S3 configurations</span>
    <span class="n">check_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Check_t</span><span class="o">.</span><span class="n">Non</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">CreateOptimizer</span><span class="p">(</span><span class="n">optimizer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Optimizer_t</span><span class="o">.</span><span class="n">SGD</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
        <span class="n">label_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">label_name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="n">dense_dim</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span>
        <span class="n">dense_name</span><span class="o">=</span><span class="s2">&quot;dense&quot;</span><span class="p">,</span>
        <span class="n">data_reader_sparse_param_array</span><span class="o">=</span><span class="p">[</span>
            <span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderSparseParam</span><span class="p">(</span><span class="s2">&quot;data1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
        <span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">SparseEmbedding</span><span class="p">(</span>
        <span class="n">embedding_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Embedding_t</span><span class="o">.</span><span class="n">DistributedSlotSparseEmbeddingHash</span><span class="p">,</span>
        <span class="n">workspace_size_per_gpu_in_mb</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
        <span class="n">embedding_vec_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">combiner</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
        <span class="n">sparse_embedding_name</span><span class="o">=</span><span class="s2">&quot;sparse_embedding1&quot;</span><span class="p">,</span>
        <span class="n">bottom_name</span><span class="o">=</span><span class="s2">&quot;data1&quot;</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Reshape</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sparse_embedding1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;reshape1&quot;</span><span class="p">],</span>
        <span class="n">leading_dim</span><span class="o">=</span><span class="mi">416</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Concat</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;reshape1&quot;</span><span class="p">,</span> <span class="s2">&quot;dense&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;concat1&quot;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Slice</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;concat1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;slice11&quot;</span><span class="p">,</span> <span class="s2">&quot;slice12&quot;</span><span class="p">],</span>
        <span class="n">ranges</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">429</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">429</span><span class="p">)],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">MultiCross</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;slice11&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;multicross1&quot;</span><span class="p">],</span>
        <span class="n">num_layers</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;slice12&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc1&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc1&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu1&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dropout1&quot;</span><span class="p">],</span>
        <span class="n">dropout_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Concat</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dropout1&quot;</span><span class="p">,</span> <span class="s2">&quot;multicross1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;concat2&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;concat2&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc2&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">BinaryCrossEntropyLoss</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc2&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">max_iter</span> <span class="o">=</span> <span class="mi">1100</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">eval_interval</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">snapshot</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">snapshot_prefix</span> <span class="o">=</span> <span class="s2">&quot;https://s3.us-east-1.amazonaws.com/hugectr-io-test/pipeline_test/dcn_model/&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">graph_to_json</span><span class="p">(</span><span class="n">graph_config_file</span> <span class="o">=</span> <span class="s2">&quot;dcn.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting train_with_s3.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>train_with_s3.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HugeCTR Version: 4.1
====================================================Model Init=====================================================
[HCTR][06:54:55.819][WARNING][RK0][main]: The model name is not specified when creating the solver.
[HCTR][06:54:55.819][INFO][RK0][main]: Global seed is 569406237
[HCTR][06:54:55.822][INFO][RK0][main]: Device to NUMA mapping:
  GPU 0 -&gt;  node 0
[HCTR][06:54:57.710][WARNING][RK0][main]: Peer-to-peer access cannot be fully enabled.
[HCTR][06:54:57.710][INFO][RK0][main]: Start all2all warmup
[HCTR][06:54:57.710][INFO][RK0][main]: End all2all warmup
[HCTR][06:54:57.711][INFO][RK0][main]: Using All-reduce algorithm: NCCL
[HCTR][06:54:57.712][INFO][RK0][main]: Device 0: Tesla V100-SXM2-32GB
[HCTR][06:54:57.713][INFO][RK0][main]: num of DataReader workers for train: 1
[HCTR][06:54:57.713][INFO][RK0][main]: num of DataReader workers for eval: 1
[HCTR][06:54:57.714][INFO][RK0][main]: Using S3 file system backend.
[HCTR][06:54:59.762][INFO][RK0][main]: Using S3 file system backend.
[HCTR][06:55:01.777][INFO][RK0][main]: Vocabulary size: 397821
[HCTR][06:55:01.777][INFO][RK0][main]: max_vocabulary_size_per_gpu_=2457600
[HCTR][06:55:01.780][INFO][RK0][main]: Graph analysis to resolve tensor dependency
===================================================Model Compile===================================================
[HCTR][06:55:03.407][INFO][RK0][main]: gpu0 start to init embedding
[HCTR][06:55:03.408][INFO][RK0][main]: gpu0 init embedding done
[HCTR][06:55:03.409][INFO][RK0][main]: Starting AUC NCCL warm-up
[HCTR][06:55:03.411][INFO][RK0][main]: Warm-up done
===================================================Model Summary===================================================
[HCTR][06:55:03.412][INFO][RK0][main]: Model structure on each GPU
Label                                   Dense                         Sparse                        
label                                   dense                          data1                         
(1024,1)                                (1024,13)                               
——————————————————————————————————————————————————————————————————————————————————————————————————————————————————
Layer Type                              Input Name                    Output Name                   Output Shape                  
——————————————————————————————————————————————————————————————————————————————————————————————————————————————————
DistributedSlotSparseEmbeddingHash      data1                         sparse_embedding1             (1024,26,16)                  
------------------------------------------------------------------------------------------------------------------
Reshape                                 sparse_embedding1             reshape1                      (1024,416)                    
------------------------------------------------------------------------------------------------------------------
Concat                                  reshape1                      concat1                       (1024,429)                    
                                        dense                                                                                     
------------------------------------------------------------------------------------------------------------------
Slice                                   concat1                       slice11                       (1024,429)                    
                                                                      slice12                       (1024,429)                    
------------------------------------------------------------------------------------------------------------------
MultiCross                              slice11                       multicross1                   (1024,429)                    
------------------------------------------------------------------------------------------------------------------
InnerProduct                            slice12                       fc1                           (1024,1024)                   
------------------------------------------------------------------------------------------------------------------
ReLU                                    fc1                           relu1                         (1024,1024)                   
------------------------------------------------------------------------------------------------------------------
Dropout                                 relu1                         dropout1                      (1024,1024)                   
------------------------------------------------------------------------------------------------------------------
Concat                                  dropout1                      concat2                       (1024,1453)                   
                                        multicross1                                                                               
------------------------------------------------------------------------------------------------------------------
InnerProduct                            concat2                       fc2                           (1024,1)                      
------------------------------------------------------------------------------------------------------------------
BinaryCrossEntropyLoss                  fc2                           loss                                                        
                                        label                                                                                     
------------------------------------------------------------------------------------------------------------------
=====================================================Model Fit=====================================================
[HCTR][06:55:03.412][INFO][RK0][main]: Use non-epoch mode with number of iterations: 1100
[HCTR][06:55:03.412][INFO][RK0][main]: Training batchsize: 1024, evaluation batchsize: 1024
[HCTR][06:55:03.412][INFO][RK0][main]: Evaluation interval: 500, snapshot interval: 1000
[HCTR][06:55:03.412][INFO][RK0][main]: Dense network trainable: True
[HCTR][06:55:03.412][INFO][RK0][main]: Sparse embedding sparse_embedding1 trainable: True
[HCTR][06:55:03.412][INFO][RK0][main]: Use mixed precision: False, scaler: 1.000000, use cuda graph: True
[HCTR][06:55:03.412][INFO][RK0][main]: lr: 0.001000, warmup_steps: 1, end_lr: 0.000000
[HCTR][06:55:03.412][INFO][RK0][main]: decay_start: 0, decay_steps: 1, decay_power: 2.000000
[HCTR][06:55:03.412][INFO][RK0][main]: Training source file: /hugectr-io-test/data/dcn_parquet/file_list.txt
[HCTR][06:55:03.412][INFO][RK0][main]: Evaluation source file: /hugectr-io-test/data/dcn_parquet/file_list_test.txt
[HCTR][06:55:04.668][INFO][RK0][main]: Iter: 100 Time(100 iters): 1.25574s Loss: 0.712926 lr:0.001
[HCTR][06:55:06.839][INFO][RK0][main]: Iter: 200 Time(100 iters): 2.16987s Loss: 0.701584 lr:0.001
[HCTR][06:55:08.066][INFO][RK0][main]: Iter: 300 Time(100 iters): 1.22653s Loss: 0.696012 lr:0.001
[HCTR][06:55:10.229][INFO][RK0][main]: Iter: 400 Time(100 iters): 2.16121s Loss: 0.698167 lr:0.001
[HCTR][06:55:11.653][INFO][RK0][main]: Iter: 500 Time(100 iters): 1.42367s Loss: 0.695641 lr:0.001
[HCTR][06:55:29.727][INFO][RK0][main]: Evaluation, AUC: 0.500979
[HCTR][06:55:29.727][INFO][RK0][main]: Eval Time for 1280 iters: 18.0735s
[HCTR][06:55:32.311][INFO][RK0][main]: Iter: 600 Time(100 iters): 20.6575s Loss: 0.696028 lr:0.001
[HCTR][06:55:33.349][INFO][RK0][main]: Iter: 700 Time(100 iters): 1.03696s Loss: 0.693602 lr:0.001
[HCTR][06:55:35.089][INFO][RK0][main]: Iter: 800 Time(100 iters): 1.73903s Loss: 0.693618 lr:0.001
[HCTR][06:55:36.191][INFO][RK0][main]: Iter: 900 Time(100 iters): 1.10101s Loss: 0.696232 lr:0.001
[HCTR][06:55:37.789][INFO][RK0][main]: Iter: 1000 Time(100 iters): 1.59704s Loss: 0.693168 lr:0.001
[HCTR][06:55:53.378][INFO][RK0][main]: Evaluation, AUC: 0.50103
[HCTR][06:55:53.378][INFO][RK0][main]: Eval Time for 1280 iters: 15.5882s
[HCTR][06:55:53.378][INFO][RK0][main]: Using S3 file system backend.
[HCTR][06:55:55.410][INFO][RK0][main]: Rank0: Write hash table to file
[HCTR][06:55:56.473][DEBUG][RK0][main]: Successfully write to AWS S3 location:  https://s3.us-east-1.amazonaws.com/hugectr-io-test/pipeline_test/dcn_model/0_sparse_1000.model/key
[HCTR][06:55:57.348][DEBUG][RK0][main]: Successfully write to AWS S3 location:  https://s3.us-east-1.amazonaws.com/hugectr-io-test/pipeline_test/dcn_model/0_sparse_1000.model/emb_vector
[HCTR][06:55:57.360][INFO][RK0][main]: Dumping sparse weights to files, successful
[HCTR][06:55:57.360][INFO][RK0][main]: Dumping sparse optimzer states to files, successful
[HCTR][06:55:57.361][INFO][RK0][main]: Using S3 file system backend.
[HCTR][06:56:00.462][DEBUG][RK0][main]: Successfully write to AWS S3 location:  https://s3.us-east-1.amazonaws.com/hugectr-io-test/pipeline_test/dcn_model/_dense_1000.model
[HCTR][06:56:00.467][INFO][RK0][main]: Dumping dense weights to file, successful
[HCTR][06:56:00.467][INFO][RK0][main]: Using S3 file system backend.
[HCTR][06:56:02.839][DEBUG][RK0][main]: Successfully write to AWS S3 location:  https://s3.us-east-1.amazonaws.com/hugectr-io-test/pipeline_test/dcn_model/_opt_dense_1000.model
[HCTR][06:56:02.843][INFO][RK0][main]: Dumping dense optimizer states to file, successful
[HCTR][06:56:06.987][INFO][RK0][main]: Finish 1100 iterations with batchsize: 1024 in 63.58s.
[HCTR][06:56:06.988][INFO][RK0][main]: Save the model graph to dcn.json successfully
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="training-a-dcn-model-with-google-cloud-storage">
<h2>Training a DCN model with Google Cloud Storage<a class="headerlink" href="#training-a-dcn-model-with-google-cloud-storage" title="Permalink to this heading"></a></h2>
<p><strong>Before you start:</strong>
Please note that GCS SDK are NOT preinstalled in the NGC docker. To use GCS related functionalites, please do the following steps to customize the building of HugeCTR:</p>
<ol class="arabic simple">
<li><p>git clone <a class="reference external" href="https://github.com/NVIDIA/HugeCTR.git">https://github.com/NVIDIA/HugeCTR.git</a></p></li>
<li><p>cd HugeCTR</p></li>
<li><p>git submodule update –init –recursive</p></li>
<li><p>mkdir -p build &amp;&amp; cd build</p></li>
<li><p>cmake -DCMAKE_BUILD_TYPE=Release -DSM=70 -DENABLE_GCS=ON … #ENABLE_GCS option will install GCS SDKs for you.</p></li>
<li><p>make -j &amp;&amp; make install</p></li>
</ol>
<section id="id2">
<h3>Data preparation<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p><strong>Create <code class="docutils literal notranslate"><span class="pre">file_list.txt</span> <span class="pre">and</span> <span class="pre">file_list_test.txt</span></code>:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mkdir<span class="w"> </span>-p<span class="w"> </span>/hugectr-io-test/data/dcn_parquet/train
<span class="o">!</span>mkdir<span class="w"> </span>-p<span class="w"> </span>/hugectr-io-test/data/dcn_parquet/val
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /hugectr-io-test/data/dcn_parquet/file_list.txt
<span class="mi">16</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_0</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_1</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_2</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_3</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_4</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_5</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_6</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_7</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_8</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_9</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_10</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_11</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_12</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_13</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_14</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">gen_15</span><span class="o">.</span><span class="n">parquet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting /hugectr-io-test/data/dcn_parquet/file_list.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /hugectr-io-test/data/dcn_parquet/file_list_test.txt
<span class="mi">4</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_0</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_1</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_2</span><span class="o">.</span><span class="n">parquet</span>
<span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">hugectr</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dcn_parquet</span><span class="o">/</span><span class="n">val</span><span class="o">/</span><span class="n">gen_3</span><span class="o">.</span><span class="n">parquet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting /hugectr-io-test/data/dcn_parquet/file_list_test.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /hugectr-io-test/data/dcn_parquet/train/_metadata.json
<span class="p">{</span> <span class="s2">&quot;file_stats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_0.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_1.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_2.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_3.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_4.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_5.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_6.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_7.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span>
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_8.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_9.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_10.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_11.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_12.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_13.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_14.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/train/gen_15.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">}],</span> 
  <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;label0&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;conts&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C5&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C6&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C7&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C8&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C9&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C10&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C11&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C12&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">12</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C13&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;cats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C14&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C15&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C16&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C17&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">17</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C18&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">18</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C19&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C20&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C21&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C22&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">22</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C23&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C24&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C25&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C26&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">26</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C27&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">27</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C28&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">28</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C29&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">29</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C30&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C31&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">31</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C32&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">32</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C33&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C34&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">34</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C35&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C36&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">36</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C37&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">37</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C38&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">38</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C39&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">39</span><span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting /hugectr-io-test/data/dcn_parquet/train/_metadata.json
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> /hugectr-io-test/data/dcn_parquet/val/_metadata.json
<span class="p">{</span> <span class="s2">&quot;file_stats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/val/gen_0.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/val/gen_1.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span>
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/val/gen_2.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">},</span> 
                 <span class="p">{</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://hugectr-io-test/data/dcn_parquet/val/gen_3.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rows&quot;</span><span class="p">:</span><span class="mi">40960</span><span class="p">}],</span> 
  <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;label0&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;conts&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C5&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C6&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C7&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C8&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C9&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C10&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C11&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C12&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">12</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C13&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">}</span> <span class="p">],</span> 
  <span class="s2">&quot;cats&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C14&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C15&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C16&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C17&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">17</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C18&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">18</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C19&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C20&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C21&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C22&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">22</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C23&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C24&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C25&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C26&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">26</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C27&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">27</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C28&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">28</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C29&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">29</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C30&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C31&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">31</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C32&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">32</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C33&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">},</span> 
            <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C34&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">34</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C35&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C36&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">36</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C37&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">37</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C38&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">38</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="s2">&quot;C39&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="mi">39</span><span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting /hugectr-io-test/data/dcn_parquet/val/_metadata.json
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h3>Training<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<p><strong>Important APIs used in the following script:</strong></p>
<ol class="arabic simple">
<li><p>We use the <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/main/api/python_interface.html#datasourceparams-class">DataSourceParams</a> to define the remote file system to read data from, in this case, GCS.</p></li>
<li><p>In <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/main/api/python_interface.html#datareaderparams">DataReaderParams</a>, we specify the <code class="docutils literal notranslate"><span class="pre">DataSourceParams</span></code>.</p></li>
<li><p>In <a class="reference external" href="https://nvidia-merlin.github.io/HugeCTR/main/api/python_interface.html#fit-method">fit()</a> method, we specify GCS path in the <code class="docutils literal notranslate"><span class="pre">snapshot_prefix</span></code> parameters to dump trained models to GCS.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#You need to set the GCP credentials environmental variable to access the GCS.</span>

<span class="o">%</span><span class="k">env</span> GOOGLE_APPLICATION_CREDENTIALS=/path/to/your/gcs_key.json
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>env: GOOGLE_APPLICATION_CREDENTIALS=/path/to/your/gcs_key.json
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> train_with_gcs.py
<span class="kn">import</span> <span class="nn">hugectr</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">from</span> <span class="nn">hugectr.data</span> <span class="kn">import</span> <span class="n">DataSourceParams</span>

<span class="c1"># Create a file system configuration for data reading</span>
<span class="n">data_source_params</span> <span class="o">=</span> <span class="n">DataSourceParams</span><span class="p">(</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">FileSystemType_t</span><span class="o">.</span><span class="n">GCS</span><span class="p">,</span> <span class="c1">#use Google Cloud Storage</span>
    <span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;storage.googleapis.com&#39;</span><span class="p">,</span> <span class="c1">#your endpoint override, usually storage.googleapis.com or storage.google.cloud.com</span>
    <span class="n">port</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span> <span class="c1">#with be ignored</span>
<span class="p">)</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">CreateSolver</span><span class="p">(</span>
    <span class="n">max_eval_batches</span><span class="o">=</span><span class="mi">1280</span><span class="p">,</span>
    <span class="n">batchsize_eval</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="n">batchsize</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">vvgpu</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">i64_input_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">repeat_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderParams</span><span class="p">(</span>
    <span class="n">data_reader_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderType_t</span><span class="o">.</span><span class="n">Parquet</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/hugectr-io-test/data/dcn_parquet/file_list.txt&quot;</span><span class="p">],</span>
    <span class="n">eval_source</span><span class="o">=</span><span class="s2">&quot;/hugectr-io-test/data/dcn_parquet/file_list_test.txt&quot;</span><span class="p">,</span>
    <span class="n">slot_size_array</span><span class="o">=</span><span class="p">[</span><span class="mi">39884</span><span class="p">,</span><span class="mi">39043</span><span class="p">,</span><span class="mi">17289</span><span class="p">,</span><span class="mi">7420</span><span class="p">,</span><span class="mi">20263</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7120</span><span class="p">,</span><span class="mi">1543</span><span class="p">,</span><span class="mi">39884</span><span class="p">,</span><span class="mi">39043</span><span class="p">,</span><span class="mi">17289</span><span class="p">,</span><span class="mi">7420</span><span class="p">,</span><span class="mi">20263</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7120</span><span class="p">,</span><span class="mi">1543</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">39884</span><span class="p">,</span><span class="mi">39043</span><span class="p">,</span><span class="mi">17289</span><span class="p">,</span><span class="mi">7420</span><span class="p">,</span><span class="mi">20263</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7120</span><span class="p">,</span><span class="mi">1543</span><span class="p">],</span>
    <span class="n">data_source_params</span><span class="o">=</span><span class="n">data_source_params</span><span class="p">,</span> <span class="c1"># Using the GCS configurations</span>
    <span class="n">check_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Check_t</span><span class="o">.</span><span class="n">Non</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">CreateOptimizer</span><span class="p">(</span><span class="n">optimizer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Optimizer_t</span><span class="o">.</span><span class="n">SGD</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
        <span class="n">label_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">label_name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="n">dense_dim</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span>
        <span class="n">dense_name</span><span class="o">=</span><span class="s2">&quot;dense&quot;</span><span class="p">,</span>
        <span class="n">data_reader_sparse_param_array</span><span class="o">=</span><span class="p">[</span>
            <span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderSparseParam</span><span class="p">(</span><span class="s2">&quot;data1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
        <span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">SparseEmbedding</span><span class="p">(</span>
        <span class="n">embedding_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Embedding_t</span><span class="o">.</span><span class="n">DistributedSlotSparseEmbeddingHash</span><span class="p">,</span>
        <span class="n">workspace_size_per_gpu_in_mb</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
        <span class="n">embedding_vec_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">combiner</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
        <span class="n">sparse_embedding_name</span><span class="o">=</span><span class="s2">&quot;sparse_embedding1&quot;</span><span class="p">,</span>
        <span class="n">bottom_name</span><span class="o">=</span><span class="s2">&quot;data1&quot;</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Reshape</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sparse_embedding1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;reshape1&quot;</span><span class="p">],</span>
        <span class="n">leading_dim</span><span class="o">=</span><span class="mi">416</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Concat</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;reshape1&quot;</span><span class="p">,</span> <span class="s2">&quot;dense&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;concat1&quot;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Slice</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;concat1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;slice11&quot;</span><span class="p">,</span> <span class="s2">&quot;slice12&quot;</span><span class="p">],</span>
        <span class="n">ranges</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">429</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">429</span><span class="p">)],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">MultiCross</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;slice11&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;multicross1&quot;</span><span class="p">],</span>
        <span class="n">num_layers</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;slice12&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc1&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc1&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu1&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Dropout</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dropout1&quot;</span><span class="p">],</span>
        <span class="n">dropout_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Concat</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dropout1&quot;</span><span class="p">,</span> <span class="s2">&quot;multicross1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;concat2&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;concat2&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc2&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">BinaryCrossEntropyLoss</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc2&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">max_iter</span> <span class="o">=</span> <span class="mi">1100</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">eval_interval</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">snapshot</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">snapshot_prefix</span> <span class="o">=</span> <span class="s2">&quot;https://storage.googleapis.com/hugectr-io-test/pipeline_test/&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">graph_to_json</span><span class="p">(</span><span class="n">graph_config_file</span> <span class="o">=</span> <span class="s2">&quot;dcn.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting train_with_gcs.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>train_with_gcs.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HugeCTR Version: 4.1
====================================================Model Init=====================================================
[HCTR][03:15:35.248][WARNING][RK0][main]: The model name is not specified when creating the solver.
[HCTR][03:15:35.248][INFO][RK0][main]: Global seed is 1008636636
[HCTR][03:15:35.251][INFO][RK0][main]: Device to NUMA mapping:
  GPU 0 -&gt;  node 0
[HCTR][03:15:37.306][WARNING][RK0][main]: Peer-to-peer access cannot be fully enabled.
[HCTR][03:15:37.306][INFO][RK0][main]: Start all2all warmup
[HCTR][03:15:37.306][INFO][RK0][main]: End all2all warmup
[HCTR][03:15:37.307][INFO][RK0][main]: Using All-reduce algorithm: NCCL
[HCTR][03:15:37.308][INFO][RK0][main]: Device 0: Tesla V100-SXM2-32GB
[HCTR][03:15:37.308][INFO][RK0][main]: num of DataReader workers for train: 1
[HCTR][03:15:37.308][INFO][RK0][main]: num of DataReader workers for eval: 1
[HCTR][03:15:37.309][INFO][RK0][main]: Using GCS file system backend.
[HCTR][03:15:37.323][INFO][RK0][main]: Using GCS file system backend.
[HCTR][03:15:37.328][INFO][RK0][main]: Vocabulary size: 397821
[HCTR][03:15:37.329][INFO][RK0][main]: max_vocabulary_size_per_gpu_=2457600
[HCTR][03:15:37.331][INFO][RK0][main]: Graph analysis to resolve tensor dependency
[HCTR][03:15:37.331][WARNING][RK0][main]: using multi-cross v1
[HCTR][03:15:37.331][WARNING][RK0][main]: using multi-cross v1
===================================================Model Compile===================================================
[HCTR][03:15:39.005][INFO][RK0][main]: gpu0 start to init embedding
[HCTR][03:15:39.006][INFO][RK0][main]: gpu0 init embedding done
[HCTR][03:15:39.008][INFO][RK0][main]: Starting AUC NCCL warm-up
[HCTR][03:15:39.010][INFO][RK0][main]: Warm-up done
===================================================Model Summary===================================================
[HCTR][03:15:39.010][INFO][RK0][main]: Model structure on each GPU
Label                                   Dense                         Sparse                        
label                                   dense                          data1                         
(1024,1)                                (1024,13)                               
——————————————————————————————————————————————————————————————————————————————————————————————————————————————————
Layer Type                              Input Name                    Output Name                   Output Shape                  
——————————————————————————————————————————————————————————————————————————————————————————————————————————————————
DistributedSlotSparseEmbeddingHash      data1                         sparse_embedding1             (1024,26,16)                  
------------------------------------------------------------------------------------------------------------------
Reshape                                 sparse_embedding1             reshape1                      (1024,416)                    
------------------------------------------------------------------------------------------------------------------
Concat                                  reshape1                      concat1                       (1024,429)                    
                                        dense                                                                                     
------------------------------------------------------------------------------------------------------------------
Slice                                   concat1                       slice11                       (1024,429)                    
                                                                      slice12                       (1024,429)                    
------------------------------------------------------------------------------------------------------------------
MultiCross                              slice11                       multicross1                   (1024,429)                    
------------------------------------------------------------------------------------------------------------------
InnerProduct                            slice12                       fc1                           (1024,1024)                   
------------------------------------------------------------------------------------------------------------------
ReLU                                    fc1                           relu1                         (1024,1024)                   
------------------------------------------------------------------------------------------------------------------
Dropout                                 relu1                         dropout1                      (1024,1024)                   
------------------------------------------------------------------------------------------------------------------
Concat                                  dropout1                      concat2                       (1024,1453)                   
                                        multicross1                                                                               
------------------------------------------------------------------------------------------------------------------
InnerProduct                            concat2                       fc2                           (1024,1)                      
------------------------------------------------------------------------------------------------------------------
BinaryCrossEntropyLoss                  fc2                           loss                                                        
                                        label                                                                                     
------------------------------------------------------------------------------------------------------------------
=====================================================Model Fit=====================================================
[HCTR][03:15:39.011][INFO][RK0][main]: Use non-epoch mode with number of iterations: 1100
[HCTR][03:15:39.011][INFO][RK0][main]: Training batchsize: 1024, evaluation batchsize: 1024
[HCTR][03:15:39.011][INFO][RK0][main]: Evaluation interval: 500, snapshot interval: 1000
[HCTR][03:15:39.011][INFO][RK0][main]: Dense network trainable: True
[HCTR][03:15:39.011][INFO][RK0][main]: Sparse embedding sparse_embedding1 trainable: True
[HCTR][03:15:39.011][INFO][RK0][main]: Use mixed precision: False, scaler: 1.000000, use cuda graph: True
[HCTR][03:15:39.011][INFO][RK0][main]: lr: 0.001000, warmup_steps: 1, end_lr: 0.000000
[HCTR][03:15:39.011][INFO][RK0][main]: decay_start: 0, decay_steps: 1, decay_power: 2.000000
[HCTR][03:15:39.011][INFO][RK0][main]: Training source file: /hugectr-io-test/data/dcn_parquet/file_list.txt
[HCTR][03:15:39.011][INFO][RK0][main]: Evaluation source file: /hugectr-io-test/data/dcn_parquet/file_list_test.txt
[HCTR][03:15:40.236][INFO][RK0][main]: Iter: 100 Time(100 iters): 1.22452s Loss: 0.786299 lr:0.001
[HCTR][03:15:41.872][INFO][RK0][main]: Iter: 200 Time(100 iters): 1.6347s Loss: 0.738846 lr:0.001
[HCTR][03:15:43.102][INFO][RK0][main]: Iter: 300 Time(100 iters): 1.22938s Loss: 0.711017 lr:0.001
[HCTR][03:15:44.736][INFO][RK0][main]: Iter: 400 Time(100 iters): 1.63355s Loss: 0.708317 lr:0.001
[HCTR][03:15:45.850][INFO][RK0][main]: Iter: 500 Time(100 iters): 1.11226s Loss: 0.697101 lr:0.001
[HCTR][03:15:59.880][INFO][RK0][main]: Evaluation, AUC: 0.501301
[HCTR][03:15:59.880][INFO][RK0][main]: Eval Time for 1280 iters: 14.0298s
[HCTR][03:16:01.456][INFO][RK0][main]: Iter: 600 Time(100 iters): 15.6054s Loss: 0.698077 lr:0.001
[HCTR][03:16:02.201][INFO][RK0][main]: Iter: 700 Time(100 iters): 0.744573s Loss: 0.697804 lr:0.001
[HCTR][03:16:03.244][INFO][RK0][main]: Iter: 800 Time(100 iters): 1.04207s Loss: 0.695543 lr:0.001
[HCTR][03:16:04.007][INFO][RK0][main]: Iter: 900 Time(100 iters): 0.761465s Loss: 0.695323 lr:0.001
[HCTR][03:16:05.289][INFO][RK0][main]: Iter: 1000 Time(100 iters): 1.28151s Loss: 0.695319 lr:0.001
[HCTR][03:16:17.647][INFO][RK0][main]: Evaluation, AUC: 0.501347
[HCTR][03:16:17.647][INFO][RK0][main]: Eval Time for 1280 iters: 12.3576s
[HCTR][03:16:17.647][INFO][RK0][main]: Using GCS file system backend.
[HCTR][03:16:17.664][INFO][RK0][main]: Rank0: Write hash table to file
[HCTR][03:16:18.623][DEBUG][RK0][main]: Successfully write to GCS location:  https://storage.googleapis.com/hugectr-io-test/pipeline_test/0_sparse_1000.model/key
[HCTR][03:16:20.289][DEBUG][RK0][main]: Successfully write to GCS location:  https://storage.googleapis.com/hugectr-io-test/pipeline_test/0_sparse_1000.model/emb_vector
[HCTR][03:16:20.294][INFO][RK0][main]: Dumping sparse weights to files, successful
[HCTR][03:16:20.294][INFO][RK0][main]: Dumping sparse optimzer states to files, successful
[HCTR][03:16:20.294][INFO][RK0][main]: Using GCS file system backend.
[HCTR][03:16:21.254][DEBUG][RK0][main]: Successfully write to GCS location:  https://storage.googleapis.com/hugectr-io-test/pipeline_test/_dense_1000.model
[HCTR][03:16:21.255][INFO][RK0][main]: Dumping dense weights to file, successful
[HCTR][03:16:21.255][INFO][RK0][main]: Using GCS file system backend.
[HCTR][03:16:21.803][DEBUG][RK0][main]: Successfully write to GCS location:  https://storage.googleapis.com/hugectr-io-test/pipeline_test/_opt_dense_1000.model
[HCTR][03:16:21.804][INFO][RK0][main]: Dumping dense optimizer states to file, successful
[HCTR][03:16:22.606][INFO][RK0][main]: Finish 1100 iterations with batchsize: 1024 in 43.60s.
[HCTR][03:16:22.607][INFO][RK0][main]: Save the model graph to dcn.json successfully
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="HugeCTR Example Notebooks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="embedding_collection.html" class="btn btn-neutral float-right" title="HugeCTR Embedding Collection" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, NVIDIA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../v23.08.00/index.html">v23.08.00</a></dd>
      <dd><a href="../../v23.09.00/index.html">v23.09.00</a></dd>
      <dd><a href="../../v23.12.00/index.html">v23.12.00</a></dd>
      <dd><a href="../../v24.04.00/index.html">v24.04.00</a></dd>
      <dd><a href="../../v24.06.00/index.html">v24.06.00</a></dd>
      <dd><a href="../../v25.03.00/index.html">v25.03.00</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="training_with_remote_filesystem.html">main</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NVJ1Y1YJHK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-NVJ1Y1YJHK', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>